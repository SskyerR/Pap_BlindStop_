#include <TinyGPS++.h>
#include <SoftwareSerial.h>

int RXPin = 3;
int TXPin = 2;

int GPSBaud = 9600;

TinyGPSPlus gps;

SoftwareSerial gpsSerial(RXPin, TXPin);

void setup()
{
Serial.begin(9600);
gpsSerial.begin(GPSBaud);
}

void loop()
{
while (gpsSerial.available() > 0)
if (gps.encode(gpsSerial.read()))
displayInfo();

if (millis() > 5000 && gps.charsProcessed() < 10)
{
Serial.println("GPS nao detetado, verifique as conexoes.");
while (true);
}
}

void displayInfo()
{
if (gps.location.isValid())
{
Serial.print("Latitude: ");
Serial.println(gps.location.lat(), 6);
Serial.print("Longitude: ");
Serial.println(gps.location.lng(), 6);
Serial.print("Altitude: ");
Serial.println(gps.altitude.meters(), 6);

if ( gps.location.lng() > -8.791248 && gps.location.lng() < -8.790780 && gps.location.lat() < 39.026586 && gps.location.lat() > 39.026454) {
Serial.println("estou na paragem 1");

}
else {
Serial.println("nao estou na paragem 1");
Serial.print("Latitude: ");
Serial.println(gps.location.lat(), 6);
Serial.print("Longitude: ");
Serial.println(gps.location.lng(), 6);

}
if ( gps.location.lng() > -8.791013 && gps.location.lng() < -8.790544 && gps.location.lat() < 39.026791 && gps.location.lat() > 39.026713) {
Serial.println("estou na paragem 2");

}
else {
Serial.println("nao estou na paragem 2");
Serial.print("Latitude: ");
Serial.println(gps.location.lat(), 6);
Serial.print("Longitude: ");
Serial.println(gps.location.lng(), 6);
}
}
else
{
Serial.println("Local: Indisponivel");
}

Serial.print("Data: ");
if (gps.date.isValid())
{
Serial.print(gps.date.day());
Serial.print("/");
Serial.print(gps.date.month());
Serial.print("/");
Serial.println(gps.date.year());
}
else
{
Serial.println("Indisponivel");
}

Serial.print("Hora: ");
if (gps.time.isValid())
{
if (gps.time.hour() < 10) Serial.print(F("0"));
Serial.print(gps.time.hour());
Serial.print(":");
if (gps.time.minute() < 10) Serial.print(F("0"));
Serial.print(gps.time.minute());
Serial.print(":");
if (gps.time.second() < 10) Serial.print(F("0"));
Serial.print(gps.time.second());
Serial.print(".");
if (gps.time.centisecond() < 10) Serial.print(F("0"));
Serial.println(gps.time.centisecond());
}
else
{
Serial.println("Indisponivel");
}

Serial.println();
Serial.println();
delay(1000);
} 
